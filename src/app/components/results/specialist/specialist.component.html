<div class="back" [routerLink]="'/user-list'">
  <img src="https://fuwqovndluczbpnnywse.supabase.co/storage/v1/object/public/images/fondo/back.png" alt=""
    class="imgBack" />
</div>

<!-- Loading -->
<div *ngIf="loading" class="loading">Cargando usuarios...</div>

<!-- Sin resultados -->
<div *ngIf="!loading && users.length === 0" class="no-results">
  No hay usuarios pendientes.
</div>

<!-- Tabla de usuarios -->
<table *ngIf="!loading && users.length > 0" class="fancy-table">
  <thead>
    <tr>
      <th>Foto</th>
      <th>Nombre</th>
      <th>Email</th>
      <th>Edad</th>
      <th>DNI</th>
      <th>Rol</th>
      <th>Activo</th>
      <th>Estado</th>
      <th>Accion</th>
    </tr>
  </thead>
  <tbody>
    <tr *ngFor="let user of paginatedUsers">
      <td>
        <img [src]="(user.first_photo_url || '') | defaultSpecialist" alt="Foto" class="user-photo" />
      </td>
      <td>{{ user.first_name }} {{ user.last_name }}</td>
      <td>{{ user.email }}</td>
      <td>{{ user.age }}</td>
      <td>{{ user.dni }}</td>
      <td>{{ user.role }}</td>

      <td>
        <span class="status" [class.active]="user.is_active" [class.inactive]="!user.is_active">
          {{ user.is_active ? 'Activo' : 'Inactivo' }}
        </span>
      </td>

      <td>
        <span class="status" [ngClass]="{
            accepted: user.status === 'approved',
            pending: user.status === 'pending',
            rejected: user.status === 'rejected',
            default: user.role !== 'Especialista'
          }">
          {{
          user.status === 'approved'
          ? 'Aceptado'
          : user.status === 'pending'
          ? 'Pendiente'
          : user.status === 'rejected'
          ? 'Rechazado'
          : '-'
          }}
        </span>
      </td>
      <td>
        <div class="actions">
          <button *ngIf="user.status === 'pending'" (click)="acceptUser(user)">Aceptar</button>
          <button *ngIf="user.status === 'pending'" (click)="rejectUser(user)">Rechazar</button>
          <button (click)="viewUserDetails(user)">Ver</button>
        </div>
      </td>
    </tr>
  </tbody>
</table>

<!-- Paginación -->
<div class="pagination" *ngIf="totalPages > 1">
  <button (click)="goToPage(currentPage - 1)" [disabled]="currentPage === 1">&lt;</button>

  <button *ngFor="let page of [].constructor(totalPages); let i = index" (click)="goToPage(i + 1)"
    [class.active]="currentPage === i + 1">
    {{ i + 1 }}
  </button>

  <button (click)="goToPage(currentPage + 1)" [disabled]="currentPage === totalPages">&gt;</button>
</div>


<!-- Modal de Bootstrap -->
<div class="modal fade" tabindex="-1" [ngClass]="{ show: showModal }" [ngStyle]="{ display: showModal ? 'block' : 'none' }">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Detalles del usuario</h5>
        <button type="button" class="btn-close" (click)="closeModal()"></button>
      </div>
      <div class="modal-body" *ngIf="selectedUser">
        <div class="text-center mb-3">
          <img
            [src]="(selectedUser.first_photo_url || '') | defaultSpecialist"
            class="rounded-circle"
            width="100"
            height="100"
            alt="Foto de usuario"
          />
        </div>
        <p><strong>Nombre:</strong> {{ selectedUser.first_name }} {{ selectedUser.last_name }}</p>
        <p><strong>Email:</strong> {{ selectedUser.email }}</p>
        <p><strong>Edad:</strong> {{ selectedUser.age }}</p>
        <p><strong>DNI:</strong> {{ selectedUser.dni }}</p>
        <p><strong>Rol:</strong> {{ selectedUser.role }}</p>
        <p><strong>Activo:</strong> {{ selectedUser.is_active ? 'Sí' : 'No' }}</p>
        <p><strong>Estado:</strong> {{ selectedUser.status }}</p>
        <div *ngIf="selectedUser.specialty?.length">
          <p><strong>Especialidades:</strong></p>
          <ul>
            <li *ngFor="let spec of selectedUser.specialty">{{ spec }}</li>
          </ul>
        </div>
        <p><strong>Creado en:</strong> {{ selectedUser.created_at | date: 'dd/MM/yyyy HH:mm' }}</p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" (click)="closeModal()">Cerrar</button>
      </div>
    </div>
  </div>
</div>